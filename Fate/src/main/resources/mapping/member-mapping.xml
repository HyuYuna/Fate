<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberDao">

	<resultMap type="memberVO" id="member">
		<result property="custno" column="custno" />
		<result property="custname" column="CUSTNAME" />
		<result property="phone" column="PHONE" />
		<result property="address" column="address" />
		<result property="joindate" column="JOINDATE" />
		<result property="grade" column="GRADE" />
		<result property="city" column="CITY" />
		<result property="content" column="CONTENT" />
	</resultMap>
	<resultMap type="HashMap" id="Maps">
		<result property="custno" column="custno" />
		<result property="custname" column="CUSTNAME" />
		<result property="phone" column="PHONE" />
		<result property="address" column="address" />
		<result property="joindate" column="JOINDATE" />
		<result property="grade" column="GRADE" />
		<result property="city" column="CITY" />
	</resultMap>
	
	<!--  전체 회원 목록 -->
	<select id="selectAllmember" parameterType="memberVO" resultMap="member">
		SELECT 
			* 
		FROM 
			MEMBER
		<where>
			<if test="searchType=='custno'">
				AND CUSTNO LIKE CONCAT('%',#{keyword},'%')
			</if>
			<if test="searchType=='name'">
				AND CUSTNAME LIKE CONCAT('%',#{keyword},'%')
			</if>
		</where>
		ORDER BY CUSTNO DESC
		LIMIT #{startList} , #{listSize}
	</select>

	<!-- 전체 회원(그리드용) -->
	<select id="selectAllMemberJson" parameterType="Map" resultType="memberVO">
		SELECT 
			AAA.* 
		FROM (
			SELECT
				ROW_NUMBER() OVER ( 
					order by ${SIDX}
					<if test="SORD == ('asc')">ASC</if>
					<if test="SORD == ('desc')">DESC</if>
				) RNUM,
					E.custno, E.custname, E.phone, E.address, E.joindate, E.grade, E.city
				FROM MEMBER AS E
			) AAA
		WHERE
			AAA.RNUM 
		BETWEEN 
			${startCount} AND ${endCount}

	</select>
	
	<select id="totalPage" parameterType="Integer" resultType="Integer">
		SELECT
			FLOOR((count(*)/#{rows} )+1)
		FROM
			MEMBER
	</select>	
	
	<!-- 회원수 -->
	<select id="memberCnt" parameterType="memberVO" resultType="Integer">
	 	SELECT 
	 		COUNT(*) as listCnt
	 	FROM
	 		MEMBER 
	 	<where>
			<if test="searchType=='custno'">
				AND CUSTNO LIKE CONCAT('%',#{keyword},'%')
			</if>
			<if test="searchType=='name'">
				AND CUSTNAME LIKE CONCAT('%',#{keyword},'%')
			</if>
		</where>
	</select>
	
	<!-- 총 회원수 -->
	<select id="totalRecords" resultType="Integer">
	 	SELECT 
	 		COUNT(*) as listCnt
	 	FROM
	 		MEMBER 
	</select>
	
	<!-- 회원 상세 -->
	<select id="selectMember" parameterType="Integer" resultType="memberVO">
	  <![CDATA[
	   SELECT 
	   	   * 
	   FROM 
	   	   MEMBER 
	   WHERE 
	   	   CUSTNO = #{custno}
	  ]]>
	</select>
	
	<!-- 회원 등록 -->
	<insert id="insertMember" parameterType="memberVO">
 	 <![CDATA[
		INSERT INTO MEMBER
		(
			custname, 
			phone, 
			address,
			joindate, 
			grade, 
			city,
			content
		) VALUES (
			#{custname}, 
			#{phone}, 
			#{address},
			#{joindate}, 
			#{grade}, 
			#{city},
			#{content}
		) 	
		 ]]>
	</insert>
	
	 <!-- 회원 삭제 -->
	<delete id="deleteMember" parameterType="Integer">
	 <![CDATA[
	 	DELETE FROM 
	 		MEMBER 
	 	WHERE 
	 		CUSTNO = #{custno}
	 ]]>
	</delete>
	
	<!-- 회원 수정 -->
	<update id="updateMember" parameterType="memberVO">
	 <![CDATA[
		UPDATE 
			MEMBER 
		SET 
			CUSTNAME= #{custname}, 
			PHONE= #{phone}, 
			ADDRESS= #{address},  
			JOINDATE= #{joindate},  
			GRADE= #{grade}, 
			CITY= #{city},
			CONTENT= #{content}
		WHERE 
			CUSTNO = #{custno}
	 ]]>
	</update>
	
</mapper>